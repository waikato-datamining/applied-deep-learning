
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Applied Deep Learning.">
      
      
      
        <link rel="canonical" href="https://www.data-mining.co.nz/applied-deep-learning/speech_to_text/coqui_stt/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Coqui STT - Applied Deep Learning</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prerequisites" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Applied Deep Learning" class="md-header__button md-logo" aria-label="Applied Deep Learning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Applied Deep Learning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Coqui STT
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/waikato-datamining/applied-deep-learning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Applied Deep Learning" class="md-nav__button md-logo" aria-label="Applied Deep Learning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Applied Deep Learning
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/waikato-datamining/applied-deep-learning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../prerequisites/" class="md-nav__link">
        Prerequisites
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../previewing_predictions/" class="md-nav__link">
        Previewing predictions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Image classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image classification" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Image classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../image_classification/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../image_classification/annotate/" class="md-nav__link">
        Annotate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../image_classification/frameworks/" class="md-nav__link">
        Frameworks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Object detection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Object detection" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Object detection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../object_detection/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../object_detection/annotate/" class="md-nav__link">
        Annotate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../object_detection/frameworks/" class="md-nav__link">
        Frameworks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Instance segmentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Instance segmentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Instance segmentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../instance_segmentation/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../instance_segmentation/annotate/" class="md-nav__link">
        Annotate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../instance_segmentation/frameworks/" class="md-nav__link">
        Frameworks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Image segmentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image segmentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Image segmentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../image_segmentation/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../image_segmentation/annotate/" class="md-nav__link">
        Annotate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../image_segmentation/frameworks/" class="md-nav__link">
        Frameworks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Speech-to-text
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Speech-to-text" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Speech-to-text
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../annotate/" class="md-nav__link">
        Annotate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../frameworks/" class="md-nav__link">
        Frameworks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training" class="md-nav__link">
    Training
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-the-model" class="md-nav__link">
    Evaluating the model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exporting-to-tflite" class="md-nav__link">
    Exporting to tflite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predicting" class="md-nav__link">
    Predicting
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/waikato-datamining/applied-deep-learning/edit/main/docs/speech_to_text/coqui_stt.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Coqui STT</h1>

<p><a href="https://github.com/coqui-ai/STT">Coqui STT</a> is a deep learning toolkit for Speech-to-Text. 
Custom docker images with additional tools are available from here:</p>
<p><a href="https://github.com/waikato-datamining/tensorflow/tree/master/coqui/stt">https://github.com/waikato-datamining/tensorflow/tree/master/coqui/stt</a></p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h2>
<p>Make sure you have the directory structure created as outlined in the <a href="../../prerequisites/">Prerequisites</a>.</p>
<h2 id="data">Data<a class="headerlink" href="#data" title="Permanent link">#</a></h2>
<p>In this example, we will use the <em>Irish dataset</em> of the <a href="https://datasets.cms.waikato.ac.nz/ufdl/living-audio-datasets/">Living Audio Datasets</a>
collection.</p>
<p>Download the dataset from the following URL into the <em>data</em> directory and extract it:</p>
<p><a href="https://datasets.cms.waikato.ac.nz/ufdl/data/living-audio-datasets/irish-coqui-stt.zip">https://datasets.cms.waikato.ac.nz/ufdl/data/living-audio-datasets/irish-coqui-stt.zip</a></p>
<p>Rename the <code>coqui-stt</code> directory to <code>lad-irish</code>.</p>
<h2 id="training">Training<a class="headerlink" href="#training" title="Permanent link">#</a></h2>
<p>For training, we will use the following docker image:</p>
<pre><code>waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6
</code></pre>
<p>At prediction time, we no longer need a GPU and can use this image:</p>
<pre><code>waikatodatamining/tf_coqui_stt:1.15.2_0.10.0a10_cpu
</code></pre>
<p>The training script is called <code>stt_train</code>, for which we can invoke the help screen as follows:</p>
<pre><code class="language-bash">docker run -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 stt_train --help 
</code></pre>
<p>Instead of using config files, we can just tweak parameters via 
<a href="https://stt.readthedocs.io/en/stable/TRAINING_FLAGS.html">command-line options</a>.</p>
<p>However, we still need to download a base model to use for transfer learning:</p>
<p><a href="https://github.com/coqui-ai/STT/releases/download/v1.3.0/coqui-stt-1.3.0-checkpoint.tar.gz">https://github.com/coqui-ai/STT/releases/download/v1.3.0/coqui-stt-1.3.0-checkpoint.tar.gz</a> (648MB)</p>
<p>Download it into the <code>models</code> directory and decompress it (<code>tar -xzf coqui-stt-1.3.0-checkpoint.tar.gz</code>).</p>
<p>It is good practice creating a separate sub-directory for each training run, with a directory name that hints at
what dataset and model were used. So for our first training run, which will use mainly default parameters, we will 
create the following directory in the <code>output</code> folder:</p>
<pre><code>lad-irish-coqui
</code></pre>
<p>For generating the alphabet specific to this dataset, use the following command (if necessary, you can 
supply multiple CSV files to the <code>stt_alphabet</code> script):</p>
<pre><code class="language-bash">docker run \
  -u $(id -u):$(id -g) \
  -v `pwd`:/workspace \
  -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 \
  stt_alphabet \
  -i /workspace/data/lad-irish/samples.csv \
  -o /workspace/data/lad-irish/alphabet.txt
</code></pre>
<p>Kick off transfer learning with the following command:</p>
<pre><code class="language-bash">docker run \
  -u $(id -u):$(id -g) \
  --shm-size 8G \
  --gpus=all \
  -v `pwd`:/workspace \
  -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 \
  stt_train \
  --alphabet_config_path /workspace/data/lad-irish/alphabet.txt \
  --auto_input_dataset /workspace/data/lad-irish/samples.csv \
  --drop_source_layers 2 \
  --n_hidden 2048 \
  --use_allow_growth true \
  --train_cudnn true \
  --train_batch_size 16 \
  --dev_batch_size 16 \
  --export_batch_size 16 \
  --epochs 75 \
  --skip_batch_test true \
  --load_checkpoint_dir /workspace/models/coqui-stt-1.3.0-checkpoint \
  --save_checkpoint_dir /workspace/output/lad-irish-coqui
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>How many layers you drop when training with a new dataset (<code>--drop_source_layers X</code>) requires some 
  experimentation, dropping just one does not always work.</li>
<li><code>--auto_input_dataset</code> will split the single dataset into <code>train.csv</code>, <code>dev.csv</code> and <code>test.csv</code>.
  If you already have these datasets (e.g., obtained from Common Voice), then you can use the 
  <code>--train_files</code>, <code>--dev_files</code> and <code>--test_files</code> options to supply them explicitly.</li>
<li>The checkpoint available for release 1.4.0 did not work well, hence we are still using the one
  for 1.3.0.</li>
</ul>
<h2 id="evaluating-the-model">Evaluating the model<a class="headerlink" href="#evaluating-the-model" title="Permanent link">#</a></h2>
<p>Once the model has been built, we can evaluate it using <code>stt_eval</code>. This script
will use the <em>test</em> set and output the best and worst transcripts (using 
<a href="https://torchmetrics.readthedocs.io/en/stable/text/char_error_rate.html">CER</a> and
<a href="https://torchmetrics.readthedocs.io/en/stable/text/word_error_rate.html">WER</a> as metrics). 
You can run it like this:</p>
<pre><code class="language-bash">docker run \
  -u $(id -u):$(id -g) \
  --shm-size 8G \
  --gpus=all \
  -v `pwd`:/workspace \
  -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 \
  stt_eval \
  --alphabet_config_path /workspace/data/lad-irish/alphabet.txt \
  --train_files /workspace/data/lad-irish/train.csv \
  --dev_files /workspace/data/lad-irish/dev.csv \
  --test_files /workspace/data/lad-irish/test.csv \
  --test_batch_size 16 \
  --export_batch_size 16 \
  --checkpoint_dir /workspace/output/lad-irish-coqui
</code></pre>
<h2 id="exporting-to-tflite">Exporting to tflite<a class="headerlink" href="#exporting-to-tflite" title="Permanent link">#</a></h2>
<p>Before we can use our trained model, we will need to export it to <a href="https://www.tensorflow.org/lite/">TensorFlow lite</a>
(aka tflite) using the <code>stt_export</code> script: </p>
<pre><code class="language-bash">docker run \
  -u $(id -u):$(id -g) \
  --gpus=all \
  -v `pwd`:/workspace \
  -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 \
  stt_export \
  --export_quantize false \
  --checkpoint_dir /workspace/output/lad-irish-coqui \
  --export_dir /workspace/output/lad-irish-coqui/export
</code></pre>
<p>This will create a file called <code>output_graph.tflite</code> in the <code>export</code> sub-directory of the output directory.</p>
<p><strong>Notes</strong></p>
<ul>
<li><code>--export_quantize false</code> - will create a more accurate but slower model</li>
<li><code>--export_quantize true</code> - will create a model optimized for speed/memory but less accurate</li>
</ul>
<h2 id="predicting">Predicting<a class="headerlink" href="#predicting" title="Permanent link">#</a></h2>
<p>Using the <code>stt_transcribe_poll</code> script, we can batch-process audio files placed in the <code>predictions/in</code> directory
as follows (e.g., from our <em>test</em> subset): </p>
<pre><code class="language-bash">docker run \
  -u $(id -u):$(id -g) \
  -v `pwd`:/workspace \
  -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 \
  stt_transcribe_poll \
  --model /workspace/output/lad-irish-coqui/export/output_graph.tflite \
  --prediction_in /workspace/predictions/in \
  --prediction_out /workspace/predictions/out
</code></pre>
<p>If you just want to test with a single audio file, then use <code>stt_transcribe_single</code> instead
(point to the audio file with <code>--audio</code>):</p>
<pre><code class="language-bash">docker run \
  -u $(id -u):$(id -g) \
  -v `pwd`:/workspace \
  -t waikatodatamining/tf_coqui_stt:1.4.0_cuda11.6 \
  stt_transcribe_single \
  --model /workspace/output/lad-irish-coqui/export/output_graph.tflite \
  --audio /workspace/data/lad-irish/cll_z0001_018.wav
</code></pre>
<p>This will output something like this:</p>
<pre><code>Loading model from file /workspace/output/lad-irish-coqui/export/output_graph.tflite
TensorFlow: v2.9.1-11-gf8242ebc005
 Coqui STT: v1.4.0-0-gfcec06bd
INFO: Created TensorFlow Lite XNNPACK delegate for CPU.
Loaded model in 0.00207s.
Running inference.
Iir scoláira béleidis é eidrsan.
Inference took 2.371s for 2.464s audio file.
</code></pre>
<p>The ground truth for <code>cll_z0001_018.wav</code> is as follows:</p>
<pre><code>Níor scoláire béaloidis é Pedersen.
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>